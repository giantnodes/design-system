name: 'ğŸ·ï¸  '
author: 'PHILLIPS71'

inputs:
  GITHUB_TOKEN:
    required: true
  RELEASE_TYPE:
    required: true
  RELEASE_IDENTIFIER:
    required: false

runs:
  using: 'composite'
  steps:
    - name: 'ğŸ·ï¸  Increment Release'
      id: version
      uses: giantnodes/next-semver@v0.0.1
      with:
        path: VERSION.txt
        type: ${{ inputs.RELEASE_TYPE }}
        identifier: ${{ inputs.RELEASE_IDENTIFIER }}

    - name: 'ğŸ·ï¸  Version @giantnodes/design-system'
      shell: bash
      run: |
        pnpm version ${{ steps.version.outputs.version }} --no-git-tag-version

    - name: 'ğŸ·ï¸  Version @giantnodes/theme'
      working-directory: packages/theme
      shell: bash
      run: |
        pnpm version ${{ steps.version.outputs.version }} --no-git-tag-version

    - name: 'ğŸ·ï¸  Version @giantnodes/react'
      working-directory: packages/react
      shell: bash
      run: |
        pnpm version ${{ steps.version.outputs.version }} --no-git-tag-version

    - name: 'ğŸ·ï¸  Configure Git'
      shell: bash
      run: |
        git config --global user.name 'Giantnodes Bot'
        git config --global user.email 'bot@giantnodes.com'

    - name: 'ğŸ·ï¸  Tag & Commit Release'
      shell: bash
      run: |
        git checkout -b release/${{ steps.version.outputs.version }}
        git commit -m 'chore(release): ${{ steps.version.outputs.version }}'
        git tag ${{ steps.version.outputs.version }}
        git push origin release/${{ steps.version.outputs.version }} --tags --force

    - name: 'ğŸ·ï¸  Open Pull Request'
      uses: thomaseizinger/create-pull-request@master
      with:
        title: 'chore(release): ${{ steps.version.outputs.version }}'
        github_token: ${{ inputs.GITHUB_TOKEN }}
        head: release/${{ steps.version.outputs.version }}
        base: main
